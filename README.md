# steelpan
Playing with AI (Claude) assisted writing of Android app for steelpan drum practice

The initial Claude prompt was this:

How can an app for android minimize tap to tone latency?

With the answer:

To minimize tap-to-tone latency in Android audio apps, here are the key strategies:
Use Low-Latency Audio APIs:

AAudio (Android 8.0+) - The newest and most efficient API, designed specifically for low-latency audio
OpenSL ES - Lower-level C/C++ API that can achieve better latency than Java AudioTrack
Avoid the older AudioTrack API for latency-critical applications

Optimize Audio Configuration:

Use the smallest possible buffer size that doesn't cause dropouts
Call AudioManager.getProperty(AudioManager.PROPERTY_OUTPUT_FRAMES_PER_BUFFER) to get the optimal buffer size
Set sample rate to match the device's native sample rate (usually 48kHz)
Use 16-bit PCM format when possible

Audio Performance Mode:

Set AudioAttributes.FLAG_LOW_LATENCY when creating audio streams
Use AudioManager.MODE_IN_COMMUNICATION for the audio mode
Consider using PERFORMANCE_MODE_LOW_LATENCY with AAudio

Threading and Processing:

Generate audio on a separate high-priority thread
Pre-generate or cache audio samples when possible rather than synthesizing in real-time
Use native C/C++ code for audio processing to reduce overhead
Minimize garbage collection in audio threads

Hardware Considerations:

Test on devices that support low-latency audio (check PackageManager.FEATURE_AUDIO_LOW_LATENCY)
Some devices perform better than others - flagship phones typically have better audio latency
Use wired headphones rather than Bluetooth when possible

System-Level Optimizations:

Request audio focus appropriately
Disable unnecessary audio effects
Consider using shared mode instead of exclusive mode depending on your use case

The combination of AAudio with proper buffer sizing and native code processing typically yields the best results, often achieving latencies under 20ms on capable devices.

Followed by the query:

Look at this image that represents the note layout of a steelpan double guitar drum set. Write an android app that uses all the mechanisms that you suggested in this conversation to minimize tap to tone latency. The app should display a layout based on the image I uploaded, but generated by the app, not using the exact image file. When a user taps on a labeled note on the screen, the app should play a close approximation to a steelpan drum sound with the correct note. Getting minimum tap to tone latency is a priority. Consider that priority in your selection of programming language and API use.

With the response of the code and:

This Android app implements a steelpan double guitar with minimal tap-to-tone latency using several key optimizations:
Low-Latency Architecture:

Native C++ with AAudio: Uses the AAudio API in exclusive mode for the lowest possible latency
Real-time audio callback: Audio generation happens directly in the audio thread without any Java/Kotlin overhead
Pre-calculated synthesis: Uses simple sinusoidal synthesis with harmonics that can be computed in real-time

Performance Optimizations:

Lock-free communication: Uses atomic variables to pass frequency data from UI to audio thread
Minimal memory allocation: All audio processing uses stack-allocated variables
Efficient synthesis: Uses basic sine waves with harmonics rather than complex sample playback
Hardware-optimized settings: Requests exclusive mode, low-latency performance mode, and uses float format

UI Design:

Custom drawing: Recreates the steelpan layout programmatically rather than using image files
Accurate note mapping: Implements the exact note layout from your image with proper frequency mappings
Efficient touch handling: Direct coordinate-to-note mapping without complex UI frameworks

Audio Quality:

Steelpan-like timbre: Uses multiple harmonics (fundamental + 2nd, 3rd, 4th harmonics) to approximate steelpan sound
Natural envelope: Implements fade-out to simulate the natural decay of struck metal
Gentle filtering: Applies simple low-pass filtering for warmth

The app prioritizes latency over audio complexity - while real steelpan samples would sound more authentic, the synthesized approach eliminates file I/O and sample rate conversion delays that could add latency. On modern Android devices with AAudio support, this should achieve latencies well under 20ms.
To build this, you'd need to set up the NDK in your Android Studio project and ensure the CMakeLists.txt is properly configured for native audio compilation.
